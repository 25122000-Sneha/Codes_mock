import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;

public class DatabaseConnection {
    private static final String JDBC_URL = "jdbc:mysql://localhost:3306/healthcare_wecp";
    private static final String USERNAME = "root";
    private static final String PASSWORD = "hellowecp";

    public static Connection getConnection() throws SQLException {
        // create a connection to database
        return DriverManager.getConnection(JDBC_URL, USERNAME, PASSWORD);
    }
}




public class Patient {
    private int patientID;
    private String patientName;
    private String medicalHistory;

    public Patient() {
    }

    public int getPatientID() {
        return patientID;
    }

    public void setPatientID(int patientID) {
        this.patientID = patientID;
    }

    public String getPatientName() {
        return patientName;
    }

    public void setPatientName(String patientName) {
        this.patientName = patientName;
    }

    public String getMedicalHistory() {
        return medicalHistory;
    }

    public void setMedicalHistory(String medicalHistory) {
        this.medicalHistory = medicalHistory;
    }
}



public class RecordNotFoundException extends Exception {
    public RecordNotFoundException(String message) {
        super(message);
    }
}


import java.sql.*;

public class PatientDAO {

    private Connection connection;

    public PatientDAO() {
        try {
            connection = DatabaseConnection.getConnection();
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    public void createPatient(Patient patient) {
        // create a patient record into database
        // after succesfull insertion in database get autogenerated patientId and set that patientId to the patient object
        String sql = "INSERT INTO patients(patientName, medicalHistory) VALUES(?,?)";
        try(PreparedStatement st = connection.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS))
        {
            st.setString(1, patient.getPatientName());
            st.setString(2, patient.getMedicalHistory());
            st.executeUpdate();

            ResultSet rs = st.getGeneratedKeys();
            if(rs.next())
            {
                patient.setPatientID(rs.getInt(1));
            }
        }
        catch(SQLException e)
        {
            e.printStackTrace();
        }
    }

    public Patient getPatientByID(int patientID) throws RecordNotFoundException {
        // retrieve a patient record from database by patientID

        // throw RecordNotFoundException if patient with patientID not found
        String sql = "SELECT * FROM patients WHERE patientID = ?";
        try(PreparedStatement st = connection.prepareStatement(sql))
        {
            st.setInt(1, patientID);
            ResultSet rs = st.executeQuery();

            if(rs.next())
            {
                Patient p = new Patient();
                p.setPatientID(rs.getInt(1));
                p.setPatientName(rs.getString(2));
                p.setMedicalHistory(rs.getString(3));
                return p;
            }
            else 
            {
                throw new RecordNotFoundException("Patient with ID "+patientID+" not found.");
            }
        }
        catch(SQLException e)
        {
            e.printStackTrace();
            return null;
        }
    }

    public void close() {
        // close database connection
        try 
        {
            if(connection!=null)
            {
                connection.close();
            }
        }
        catch(SQLException e)
        {
            e.printStackTrace();
        }
    }
}


public class Main {
    public static void main(String[] args) {
        PatientDAO patientDAO = new PatientDAO();

        // Create a new patient record
        Patient patient1 = new Patient();
        patient1.setPatientName("John Doe");
        patient1.setMedicalHistory("High Sugar");
        patientDAO.createPatient(patient1);

        // Retrieve a patient's medical record by patientID
        try {
            Patient retrievedPatient = patientDAO.getPatientByID(patient1.getPatientID());
            System.out.println("Retrieved Patient: " + retrievedPatient.getPatientName());
            System.out.println("Medical History: " + retrievedPatient.getMedicalHistory());
        } catch (RecordNotFoundException e) {
            System.out.println(e.getMessage());
        }
        // Clean up and close the database connection
        patientDAO.close();
    }
}
